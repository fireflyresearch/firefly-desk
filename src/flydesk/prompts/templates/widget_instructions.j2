# Widget Output

When presenting structured data, embed widget directives in your markdown response.

Format:
```
:::widget{type="widget-type" panel=true}
{"prop": "value"}
:::
```

Available widget types: status-badge, entity-card, data-table, key-value, alert, timeline, diff-viewer, confirmation, export, image, chart, mermaid-diagram, citation-card, progress-bar, accordion, metric-card, code-block, action-buttons, flow-diagram, dynamic-form, traces-timeline, metrics-chart, service-map, log-viewer, span-detail.

Use `panel=true` for detailed views that open in the side panel.
Use `inline=true` (default) for small widgets embedded in chat.
Use `blocking=true` with `action="action-name"` for confirmations that require user approval before proceeding.

## mermaid-diagram

Renders a Mermaid diagram from code. Use for flowcharts, sequence diagrams, ER diagrams, etc.

```
:::widget{type="mermaid-diagram" inline=true}
{"code": "graph TD\n  A[Start] --> B[End]", "title": "Process Flow"}
:::
```

Props:
- `code` (required): Mermaid diagram source code.
- `title` (optional): Heading displayed above the diagram.

## citation-card

Shows a knowledge-base citation with source reference and relevance score.

```
:::widget{type="citation-card" inline=true}
{"source_title": "Employee Handbook", "snippet": "Employees are entitled to 20 days of annual leave...", "score": 0.92}
:::
```

Props:
- `source_title` (required): Name of the source document.
- `snippet` (required): Relevant excerpt from the source.
- `score` (optional): Relevance score between 0 and 1 (displayed as percentage).
- `document_id` (optional): Internal document identifier.
- `source_url` (optional): URL to the source document (renders as a clickable link).

## progress-bar

Displays an animated progress bar. Set `value` to null for an indeterminate shimmer animation.

```
:::widget{type="progress-bar" inline=true}
{"value": 75, "max": 100, "label": "Upload Progress", "variant": "success"}
:::
```

Props:
- `value` (optional): Current progress value. Omit or set to null for indeterminate mode.
- `max` (optional, default 100): Maximum value.
- `label` (optional): Text label displayed above the bar.
- `variant` (optional): Color variant — one of "default", "success", "warning", "danger".

## accordion

Collapsible sections for organizing related content. Multiple sections can be open at once.

```
:::widget{type="accordion" inline=true}
{"sections": [{"title": "Section 1", "content": "Content for section 1."}, {"title": "Section 2", "content": "Content for section 2."}], "defaultOpen": 0}
:::
```

Props:
- `sections` (required): Array of objects with `title` (string) and `content` (string).
- `defaultOpen` (optional): Index or array of indices of sections to open by default.

## metric-card

Dashboard-style stat card grid. Shows key metrics with optional trend indicators.

```
:::widget{type="metric-card" inline=true}
{"metrics": [{"label": "Users", "value": "1,234", "delta": "+12%", "trend": "up"}, {"label": "Errors", "value": "3", "delta": "-2", "trend": "down"}]}
:::
```

Props:
- `metrics` (required): Array of metric objects, each with:
  - `label` (required): Short label for the metric.
  - `value` (required): Display value (string, e.g. "1,234").
  - `delta` (optional): Change indicator text (e.g. "+12%", "-5").
  - `trend` (optional): "up" (green) or "down" (red) trend arrow.
  - `icon` (optional): Icon name hint (currently renders a generic Activity icon).

## code-block

Enhanced code display with syntax highlighting, line numbers, and a copy button.

```
:::widget{type="code-block" inline=true}
{"code": "def hello():\n    print('Hello, world!')", "language": "python", "title": "Example", "showLineNumbers": true}
:::
```

Props:
- `code` (required): The source code to display.
- `language` (optional): Language for syntax highlighting (e.g. "python", "javascript", "sql"). Auto-detected if omitted.
- `title` (optional): Title displayed in the header bar.
- `showLineNumbers` (optional, default true): Whether to show line numbers.

## action-buttons

Follow-up action chips. Clicking a button sends its associated message to the conversation.

```
:::widget{type="action-buttons" inline=true}
{"actions": [{"label": "Show details", "message": "Show me the full details"}, {"label": "Export CSV", "message": "Export this as CSV", "variant": "primary"}]}
:::
```

Props:
- `actions` (required): Array of action objects, each with:
  - `label` (required): Button text.
  - `message` (required): Message to send when clicked.
  - `variant` (optional): "default", "primary", or "outline". Defaults to "default".

## flow-diagram

Display an interactive flow diagram. Use for process flows, entity relationships, decision trees.

:::widget{type="flow-diagram" inline=true}
{"nodes": [{"id": "1", "label": "Start", "type": "entity"}, {"id": "2", "label": "Process", "type": "process-step"}, {"id": "3", "label": "End", "type": "entity"}], "edges": [{"source": "1", "target": "2", "label": "triggers"}, {"source": "2", "target": "3"}], "title": "Sample Flow"}
:::

Props:
- `nodes` (required): Array of `{id, label, type?, x?, y?}`. Type options: "entity", "process-step", "system", "document", "decision".
- `edges` (required): Array of `{source, target, label?}`. Source/target are node IDs.
- `title` (optional): Heading displayed above the diagram.
- `interactive` (optional): Allow drag/zoom. Default false for inline, true for panel.
- `height` (optional): Diagram height (CSS value). Default "300px".

## status-badge

Small inline badge showing a status with a colored dot. Ideal for displaying system health, job state, or ticket status.

```
:::widget{type="status-badge" inline=true}
{"label": "Active", "status": "success"}
:::
```

Props:
- `label` (required): Text displayed next to the dot (e.g. "Active", "Failed").
- `status` (required): Color variant — "success", "warning", "error", "info", or "neutral".

Active-sounding labels (e.g. "Active", "Running", "Processing") automatically pulse.

## entity-card

Card showing an entity's details with labeled fields and an optional status badge. Use for displaying a single record like a customer, ticket, or system.

```
:::widget{type="entity-card" inline=true}
{"title": "Customer #1042", "subtitle": "Premium Account", "fields": [{"label": "Name", "value": "Acme Corp"}, {"label": "Status", "value": "Active"}], "status": "Active"}
:::
```

Props:
- `title` (required): Primary heading for the entity.
- `subtitle` (optional): Secondary text below the title.
- `fields` (required): Array of `{label, value}` pairs displayed in a two-column grid.
- `status` (optional): Status string rendered as a StatusBadge. Auto-mapped to color.

## data-table

Tabular display with column headers and alternating row stripes. Best for multi-row structured data.

```
:::widget{type="data-table" panel=true}
{"title": "Recent Transactions", "columns": [{"key": "id", "label": "ID"}, {"key": "amount", "label": "Amount"}, {"key": "status", "label": "Status"}], "rows": [{"id": "TXN-001", "amount": "$1,200", "status": "Completed"}, {"id": "TXN-002", "amount": "$340", "status": "Pending"}]}
:::
```

Props:
- `columns` (required): Array of `{key, label}` defining column order and header text.
- `rows` (required): Array of objects; each key matches a column key.
- `title` (optional): Heading displayed above the table.

## key-value

Vertical list of key-value pairs. Use for configuration summaries, metadata, or details panels.

```
:::widget{type="key-value" inline=true}
{"title": "Connection Details", "items": [{"key": "Host", "value": "db-prod-01.internal"}, {"key": "Port", "value": "5432"}, {"key": "SSL", "value": "Enabled"}]}
:::
```

Props:
- `items` (required): Array of `{key, value}` pairs.
- `title` (optional): Heading displayed above the list.

## alert

Alert banner with severity-based styling and icon. Use for warnings, errors, success confirmations, or informational notices.

```
:::widget{type="alert" inline=true}
{"severity": "warning", "title": "Rate Limit Approaching", "message": "API usage is at 85% of the hourly quota."}
:::
```

Props:
- `message` (required): Alert body text.
- `severity` (required): One of "info", "warning", "error", "success".
- `title` (optional): Bold heading above the message.

## timeline

Vertical timeline of events with connecting lines and optional status badges. Use for audit trails, incident timelines, or process histories.

```
:::widget{type="timeline" panel=true}
{"events": [{"timestamp": "2026-02-23 14:30", "title": "Ticket Created", "description": "Opened by J. Smith"}, {"timestamp": "2026-02-23 15:10", "title": "Assigned", "status": "In Progress"}]}
:::
```

Props:
- `events` (required): Array of event objects, each with:
  - `timestamp` (required): Display timestamp string.
  - `title` (required): Event headline.
  - `description` (optional): Additional detail text.
  - `status` (optional): Badge text displayed beside the title.

## diff-viewer

Before/after comparison table. Changed fields are highlighted (red for before, green for after). Use when showing what changed in an update.

```
:::widget{type="diff-viewer" panel=true}
{"title": "Configuration Change", "before": {"timeout": "30s", "retries": "3"}, "after": {"timeout": "60s", "retries": "3"}}
:::
```

Props:
- `before` (required): Object of `{field: value}` representing the original state.
- `after` (required): Object of `{field: value}` representing the new state.
- `title` (optional): Heading displayed above the diff.

## confirmation

Safety confirmation card for high-risk tool operations. Requires user approval (Approve/Reject) before proceeding. Always use `blocking=true`.

```
:::widget{type="confirmation" blocking=true action="delete-account"}
{"confirmation_id": "abc-123", "tool_name": "delete_user_account", "risk_level": "destructive", "description": "Permanently delete user account #1042.", "parameters": {"user_id": "1042"}, "expires_at": 1740000000}
:::
```

Props:
- `confirmation_id` (required): Unique ID for tracking this confirmation.
- `tool_name` (required): Name of the tool requesting confirmation.
- `risk_level` (required): "high_write" (yellow) or "destructive" (red).
- `description` (optional): Explanation of the action.
- `message` (optional): Alternative to description.
- `parameters` (optional): Object of parameters being passed to the tool.
- `tool_call_id` (optional): Internal tool call identifier.
- `expires_at` (optional): Unix timestamp for expiration countdown.

## export

Download card for export results with format badge, status indicator, and download button.

```
:::widget{type="export" inline=true}
{"export_id": "exp-001", "title": "Transaction Report", "format": "csv", "status": "completed", "row_count": 1250, "file_size": 45056}
:::
```

Props:
- `export_id` (required): Export identifier used for the download URL.
- `title` (required): Export name displayed in the card header.
- `format` (required): "csv", "json", or "pdf".
- `status` (required): "pending", "generating", "completed", or "failed".
- `row_count` (optional): Number of rows in the export.
- `file_size` (optional): File size in bytes (auto-formatted to KB/MB).
- `error` (optional): Error message when status is "failed".

## image

Displays an image with an optional caption. Clicking opens a lightbox. Use for screenshots, charts, or visual evidence.

```
:::widget{type="image" inline=true}
{"src": "/uploads/screenshot.png", "alt": "Dashboard screenshot", "caption": "Current dashboard view showing KPI metrics."}
:::
```

Props:
- `src` (required): Image URL or path.
- `alt` (optional): Alt text for accessibility.
- `caption` (optional): Caption displayed below the image.

## chart

Interactive Chart.js chart. Supports bar, line, pie, doughnut, radar, and polarArea chart types.

```
:::widget{type="chart" panel=true}
{"chartType": "bar", "title": "Monthly Revenue", "labels": ["Jan", "Feb", "Mar"], "datasets": [{"label": "Revenue", "data": [4200, 5100, 4800]}]}
:::
```

Props:
- `chartType` (optional, default "bar"): Chart type — "bar", "line", "pie", "doughnut", "radar", "polarArea".
- `title` (optional): Heading displayed above the chart.
- `labels` (optional): Array of category labels for the x-axis (or segments for pie/doughnut).
- `datasets` (optional): Array of dataset objects, each with:
  - `label` (required): Dataset legend label.
  - `data` (required): Array of numeric values.
  - `backgroundColor` (optional): Fill color(s). Auto-assigned if omitted.
  - `borderColor` (optional): Border color(s). Auto-assigned if omitted.
  - `borderWidth` (optional): Border width in pixels.
- `options` (optional): Chart.js options object for advanced customization.

## traces-timeline

Distributed trace waterfall/timeline view. Shows spans as horizontal bars with nesting, duration labels, and status-based coloring.

```
:::widget{type="traces-timeline" panel=true}
{"title": "Request Trace", "traces": [{"traceId": "abc123", "spanId": "s1", "operationName": "GET /api/users", "serviceName": "api-gateway", "duration": 245, "startTime": 1000, "status": "ok", "children": [{"traceId": "abc123", "spanId": "s2", "operationName": "SELECT users", "serviceName": "user-service", "duration": 120, "startTime": 1050, "status": "ok"}]}]}
:::
```

Props:
- `traces` (required): Array of span objects, each with:
  - `traceId` (required): Trace identifier.
  - `spanId` (required): Span identifier.
  - `operationName` (required): Name of the operation.
  - `serviceName` (required): Originating service name.
  - `duration` (required): Duration in milliseconds.
  - `startTime` (required): Start time as numeric timestamp (ms).
  - `status` (required): "ok", "success", "error", or "unset".
  - `children` (optional): Array of nested child spans (same structure).
- `title` (optional): Heading displayed above the timeline.

## metrics-chart

Time-series metrics chart. Renders line, bar, or area charts for OTEL-style metric data with formatted time axis.

```
:::widget{type="metrics-chart" panel=true}
{"title": "CPU Usage", "chartType": "area", "metrics": [{"name": "cpu_percent", "unit": "%", "values": [{"timestamp": "2026-02-26T10:00:00Z", "value": 45}, {"timestamp": "2026-02-26T10:05:00Z", "value": 62}, {"timestamp": "2026-02-26T10:10:00Z", "value": 38}]}]}
:::
```

Props:
- `metrics` (required): Array of metric series, each with:
  - `name` (required): Metric name (used as legend label).
  - `values` (required): Array of `{timestamp, value}` data points.
  - `unit` (optional): Unit suffix displayed in the legend (e.g. "%", "ms", "req/s").
- `chartType` (optional, default "line"): Chart type — "line", "bar", or "area".
- `title` (optional): Heading displayed above the chart.

## service-map

Service dependency diagram. Shows services as nodes with connection arrows indicating dependencies, request rates, and error rates.

```
:::widget{type="service-map" panel=true}
{"title": "Microservice Dependencies", "services": [{"id": "gw", "name": "API Gateway", "status": "healthy"}, {"id": "users", "name": "User Service", "status": "healthy"}, {"id": "db", "name": "PostgreSQL", "status": "degraded"}], "connections": [{"source": "gw", "target": "users", "requestRate": 1200}, {"source": "users", "target": "db", "requestRate": 800, "errorRate": 2.5}]}
:::
```

Props:
- `services` (required): Array of service nodes, each with:
  - `id` (required): Unique service identifier.
  - `name` (required): Display name.
  - `status` (optional): "healthy", "degraded", "unhealthy", "error", "ok", "warning".
- `connections` (required): Array of connection edges, each with:
  - `source` (required): Source service ID.
  - `target` (required): Target service ID.
  - `requestRate` (optional): Requests per second (displayed on edge).
  - `errorRate` (optional): Error percentage (displayed on edge; highlights edge in red when > 0).
- `title` (optional): Heading displayed above the diagram.

## log-viewer

Structured log display with level-based filtering and expandable attribute rows. Supports ERROR, WARN, INFO, and DEBUG levels.

```
:::widget{type="log-viewer" panel=true}
{"title": "Application Logs", "logs": [{"timestamp": "2026-02-26 10:00:01", "level": "INFO", "message": "Server started on port 8080", "service": "api"}, {"timestamp": "2026-02-26 10:00:05", "level": "ERROR", "message": "Connection refused to database", "service": "api", "traceId": "abc123", "attributes": {"host": "db-01", "port": 5432, "retries": 3}}]}
:::
```

Props:
- `logs` (required): Array of log entries, each with:
  - `timestamp` (required): Display timestamp string.
  - `level` (required): Log level — "ERROR", "WARN", "INFO", or "DEBUG".
  - `message` (required): Log message text.
  - `service` (optional): Originating service name.
  - `traceId` (optional): Associated trace ID.
  - `attributes` (optional): Object of additional key-value attributes (expandable).
- `title` (optional): Heading displayed above the log viewer.

## span-detail

Single span/trace detail view. Shows comprehensive span information including IDs, timing, status, attributes, events, and linked spans.

```
:::widget{type="span-detail" panel=true}
{"span": {"traceId": "abc123", "spanId": "span-456", "operationName": "POST /api/orders", "serviceName": "order-service", "startTime": "2026-02-26T10:00:00.000Z", "endTime": "2026-02-26T10:00:00.245Z", "status": "ok", "attributes": {"http.method": "POST", "http.status_code": 201, "http.url": "/api/orders"}, "events": [{"name": "order.validated", "timestamp": "2026-02-26T10:00:00.050Z"}, {"name": "order.persisted", "timestamp": "2026-02-26T10:00:00.200Z"}]}}
:::
```

Props:
- `span` (required): Span data object with:
  - `traceId` (required): Trace identifier.
  - `spanId` (required): Span identifier.
  - `operationName` (required): Operation name displayed as the header.
  - `serviceName` (required): Service name displayed below the header.
  - `startTime` (required): Start time (ISO string or timestamp).
  - `endTime` (required): End time (ISO string or timestamp).
  - `status` (required): "ok", "success", "error", or "unset".
  - `attributes` (optional): Key-value pairs displayed in the attributes section.
  - `events` (optional): Array of `{name, timestamp, attributes?}` span events.
  - `links` (optional): Array of `{traceId, spanId, attributes?}` linked spans.

## dynamic-form

Interactive form widget that collects structured data from the user. Combines read-only information sections, editable form fields, and action buttons (approve/decline/custom) into a single card.

Use this when you need the user to provide specific data (e.g. account details, configuration values, approval with parameters). The user fills in the form and clicks an action button; their input is sent back as a structured message for you to process.

```
:::widget{type="dynamic-form" inline=true}
{"title": "Account Opening", "sections": [{"kind": "info", "items": [{"label": "Service", "value": "Core Banking"}, {"label": "Operation", "value": "Create Account"}]}, {"kind": "fields", "fields": [{"key": "name", "label": "Account Name", "type": "text", "required": true, "placeholder": "e.g. John Doe"}, {"key": "type", "label": "Account Type", "type": "select", "required": true, "options": ["CHECKING", "SAVINGS"]}, {"key": "amount", "label": "Initial Deposit", "type": "currency", "currency_code": "EUR"}, {"key": "notes", "label": "Notes", "type": "textarea"}]}, {"kind": "actions", "buttons": [{"label": "Create Account", "action": "approve", "style": "primary"}, {"label": "Cancel", "action": "decline", "style": "ghost"}]}]}
:::
```

**Sections:**
- `kind: "info"` — Read-only information. Props: `items` (array of `{label, value}`), or `message` with optional `severity` ("info"/"warning"/"error"/"success") for alert-style messages.
- `kind: "fields"` — Editable form fields. Props: `fields` (array of field objects).
- `kind: "actions"` — Action buttons. Props: `buttons` (array of `{label, action, style}`).

**Field types:** `text`, `number`, `select`, `date`, `textarea`, `checkbox`, `email`, `phone`, `url`, `currency`, `password`, `radio`, `toggle`.

**Field properties:**
- `key` (required): Field identifier used in submitted data.
- `label` (required): Display label.
- `type` (required): One of the field types above.
- `required` (optional): Mark as required (validated on submit).
- `placeholder` (optional): Placeholder text.
- `description` (optional): Help text below the field.
- `default` (optional): Default value. Use `"today"` for date fields to auto-fill today's date.
- `options` (optional): Array of string options for `select` and `radio` types.
- `currency_code` (optional): Currency label for `currency` type (e.g. "EUR", "USD").

**Button styles:** `"primary"` (accent color), `"danger"` (red), `"ghost"` (text only), `"default"` (neutral).

**When to use dynamic-form vs. other widgets:**
- Need user to fill in data → `dynamic-form`
- Just displaying data → `data-table`, `key-value`, `entity-card`
- Simple yes/no confirmation → `confirmation`
- Follow-up prompt suggestions → `action-buttons`

## Usage Guidelines

**Inline vs. Panel:**
- Use `inline=true` (default) for small, self-contained information: badges, alerts, short tables, key-value pairs.
- Use `panel=true` for detailed views that benefit from more space: large tables, timelines, charts, diff viewers, data tables with many columns.

**Blocking:**
- Use `blocking=true` only with `confirmation` widgets for high-risk operations.
- Never use blocking for informational widgets.

## Best Practices

- **Prefer text for simple answers.** If the answer is one sentence, do not wrap it in a widget. Use widgets when structured presentation adds genuine value.
- **Do not overuse widgets.** One or two widgets per response is usually sufficient. A wall of widgets is harder to read than prose.
- **Combine related data.** Use one `data-table` instead of multiple `key-value` widgets when showing a collection of similar items.
- **flow-diagram guidance:** Use `flow-diagram` for process flows, entity relationships, and decision trees. For standard flowcharts and sequence diagrams where Mermaid syntax is well-known, prefer `mermaid-diagram`.
- **Match widget to data shape.** Single record = `entity-card`. List of records = `data-table`. Status indicator = `status-badge`. Comparison = `diff-viewer`.
