# Widget Output

When presenting structured data, embed widget directives in your markdown response.

Format:
```
:::widget{type="widget-type" panel=true}
{"prop": "value"}
:::
```

Available widget types: status-badge, entity-card, data-table, key-value, alert, timeline, diff-viewer, confirmation, export, image, chart, mermaid-diagram, citation-card, progress-bar, accordion, metric-card, code-block, action-buttons, flow-diagram.

Use `panel=true` for detailed views that open in the side panel.
Use `inline=true` (default) for small widgets embedded in chat.
Use `blocking=true` with `action="action-name"` for confirmations that require user approval before proceeding.

## mermaid-diagram

Renders a Mermaid diagram from code. Use for flowcharts, sequence diagrams, ER diagrams, etc.

```
:::widget{type="mermaid-diagram" inline=true}
{"code": "graph TD\n  A[Start] --> B[End]", "title": "Process Flow"}
:::
```

Props:
- `code` (required): Mermaid diagram source code.
- `title` (optional): Heading displayed above the diagram.

## citation-card

Shows a knowledge-base citation with source reference and relevance score.

```
:::widget{type="citation-card" inline=true}
{"source_title": "Employee Handbook", "snippet": "Employees are entitled to 20 days of annual leave...", "score": 0.92}
:::
```

Props:
- `source_title` (required): Name of the source document.
- `snippet` (required): Relevant excerpt from the source.
- `score` (optional): Relevance score between 0 and 1 (displayed as percentage).
- `document_id` (optional): Internal document identifier.
- `source_url` (optional): URL to the source document (renders as a clickable link).

## progress-bar

Displays an animated progress bar. Set `value` to null for an indeterminate shimmer animation.

```
:::widget{type="progress-bar" inline=true}
{"value": 75, "max": 100, "label": "Upload Progress", "variant": "success"}
:::
```

Props:
- `value` (optional): Current progress value. Omit or set to null for indeterminate mode.
- `max` (optional, default 100): Maximum value.
- `label` (optional): Text label displayed above the bar.
- `variant` (optional): Color variant — one of "default", "success", "warning", "danger".

## accordion

Collapsible sections for organizing related content. Multiple sections can be open at once.

```
:::widget{type="accordion" inline=true}
{"sections": [{"title": "Section 1", "content": "Content for section 1."}, {"title": "Section 2", "content": "Content for section 2."}], "defaultOpen": 0}
:::
```

Props:
- `sections` (required): Array of objects with `title` (string) and `content` (string).
- `defaultOpen` (optional): Index or array of indices of sections to open by default.

## metric-card

Dashboard-style stat card grid. Shows key metrics with optional trend indicators.

```
:::widget{type="metric-card" inline=true}
{"metrics": [{"label": "Users", "value": "1,234", "delta": "+12%", "trend": "up"}, {"label": "Errors", "value": "3", "delta": "-2", "trend": "down"}]}
:::
```

Props:
- `metrics` (required): Array of metric objects, each with:
  - `label` (required): Short label for the metric.
  - `value` (required): Display value (string, e.g. "1,234").
  - `delta` (optional): Change indicator text (e.g. "+12%", "-5").
  - `trend` (optional): "up" (green) or "down" (red) trend arrow.
  - `icon` (optional): Icon name hint (currently renders a generic Activity icon).

## code-block

Enhanced code display with syntax highlighting, line numbers, and a copy button.

```
:::widget{type="code-block" inline=true}
{"code": "def hello():\n    print('Hello, world!')", "language": "python", "title": "Example", "showLineNumbers": true}
:::
```

Props:
- `code` (required): The source code to display.
- `language` (optional): Language for syntax highlighting (e.g. "python", "javascript", "sql"). Auto-detected if omitted.
- `title` (optional): Title displayed in the header bar.
- `showLineNumbers` (optional, default true): Whether to show line numbers.

## action-buttons

Follow-up action chips. Clicking a button sends its associated message to the conversation.

```
:::widget{type="action-buttons" inline=true}
{"actions": [{"label": "Show details", "message": "Show me the full details"}, {"label": "Export CSV", "message": "Export this as CSV", "variant": "primary"}]}
:::
```

Props:
- `actions` (required): Array of action objects, each with:
  - `label` (required): Button text.
  - `message` (required): Message to send when clicked.
  - `variant` (optional): "default", "primary", or "outline". Defaults to "default".

## flow-diagram

Display an interactive flow diagram. Use for process flows, entity relationships, decision trees.

:::widget{type="flow-diagram" inline=true}
{"nodes": [{"id": "1", "label": "Start", "type": "entity"}, {"id": "2", "label": "Process", "type": "process-step"}, {"id": "3", "label": "End", "type": "entity"}], "edges": [{"source": "1", "target": "2", "label": "triggers"}, {"source": "2", "target": "3"}], "title": "Sample Flow"}
:::

Props:
- `nodes` (required): Array of `{id, label, type?, x?, y?}`. Type options: "entity", "process-step", "system", "document", "decision".
- `edges` (required): Array of `{source, target, label?}`. Source/target are node IDs.
- `title` (optional): Heading displayed above the diagram.
- `interactive` (optional): Allow drag/zoom. Default false for inline, true for panel.
- `height` (optional): Diagram height (CSS value). Default "300px".

## status-badge

Small inline badge showing a status with a colored dot. Ideal for displaying system health, job state, or ticket status.

```
:::widget{type="status-badge" inline=true}
{"label": "Active", "status": "success"}
:::
```

Props:
- `label` (required): Text displayed next to the dot (e.g. "Active", "Failed").
- `status` (required): Color variant — "success", "warning", "error", "info", or "neutral".

Active-sounding labels (e.g. "Active", "Running", "Processing") automatically pulse.

## entity-card

Card showing an entity's details with labeled fields and an optional status badge. Use for displaying a single record like a customer, ticket, or system.

```
:::widget{type="entity-card" inline=true}
{"title": "Customer #1042", "subtitle": "Premium Account", "fields": [{"label": "Name", "value": "Acme Corp"}, {"label": "Status", "value": "Active"}], "status": "Active"}
:::
```

Props:
- `title` (required): Primary heading for the entity.
- `subtitle` (optional): Secondary text below the title.
- `fields` (required): Array of `{label, value}` pairs displayed in a two-column grid.
- `status` (optional): Status string rendered as a StatusBadge. Auto-mapped to color.

## data-table

Tabular display with column headers and alternating row stripes. Best for multi-row structured data.

```
:::widget{type="data-table" panel=true}
{"title": "Recent Transactions", "columns": [{"key": "id", "label": "ID"}, {"key": "amount", "label": "Amount"}, {"key": "status", "label": "Status"}], "rows": [{"id": "TXN-001", "amount": "$1,200", "status": "Completed"}, {"id": "TXN-002", "amount": "$340", "status": "Pending"}]}
:::
```

Props:
- `columns` (required): Array of `{key, label}` defining column order and header text.
- `rows` (required): Array of objects; each key matches a column key.
- `title` (optional): Heading displayed above the table.

## key-value

Vertical list of key-value pairs. Use for configuration summaries, metadata, or details panels.

```
:::widget{type="key-value" inline=true}
{"title": "Connection Details", "items": [{"key": "Host", "value": "db-prod-01.internal"}, {"key": "Port", "value": "5432"}, {"key": "SSL", "value": "Enabled"}]}
:::
```

Props:
- `items` (required): Array of `{key, value}` pairs.
- `title` (optional): Heading displayed above the list.

## alert

Alert banner with severity-based styling and icon. Use for warnings, errors, success confirmations, or informational notices.

```
:::widget{type="alert" inline=true}
{"severity": "warning", "title": "Rate Limit Approaching", "message": "API usage is at 85% of the hourly quota."}
:::
```

Props:
- `message` (required): Alert body text.
- `severity` (required): One of "info", "warning", "error", "success".
- `title` (optional): Bold heading above the message.

## timeline

Vertical timeline of events with connecting lines and optional status badges. Use for audit trails, incident timelines, or process histories.

```
:::widget{type="timeline" panel=true}
{"events": [{"timestamp": "2026-02-23 14:30", "title": "Ticket Created", "description": "Opened by J. Smith"}, {"timestamp": "2026-02-23 15:10", "title": "Assigned", "status": "In Progress"}]}
:::
```

Props:
- `events` (required): Array of event objects, each with:
  - `timestamp` (required): Display timestamp string.
  - `title` (required): Event headline.
  - `description` (optional): Additional detail text.
  - `status` (optional): Badge text displayed beside the title.

## diff-viewer

Before/after comparison table. Changed fields are highlighted (red for before, green for after). Use when showing what changed in an update.

```
:::widget{type="diff-viewer" panel=true}
{"title": "Configuration Change", "before": {"timeout": "30s", "retries": "3"}, "after": {"timeout": "60s", "retries": "3"}}
:::
```

Props:
- `before` (required): Object of `{field: value}` representing the original state.
- `after` (required): Object of `{field: value}` representing the new state.
- `title` (optional): Heading displayed above the diff.

## confirmation

Safety confirmation card for high-risk tool operations. Requires user approval (Approve/Reject) before proceeding. Always use `blocking=true`.

```
:::widget{type="confirmation" blocking=true action="delete-account"}
{"confirmation_id": "abc-123", "tool_name": "delete_user_account", "risk_level": "destructive", "description": "Permanently delete user account #1042.", "parameters": {"user_id": "1042"}, "expires_at": 1740000000}
:::
```

Props:
- `confirmation_id` (required): Unique ID for tracking this confirmation.
- `tool_name` (required): Name of the tool requesting confirmation.
- `risk_level` (required): "high_write" (yellow) or "destructive" (red).
- `description` (optional): Explanation of the action.
- `message` (optional): Alternative to description.
- `parameters` (optional): Object of parameters being passed to the tool.
- `tool_call_id` (optional): Internal tool call identifier.
- `expires_at` (optional): Unix timestamp for expiration countdown.

## export

Download card for export results with format badge, status indicator, and download button.

```
:::widget{type="export" inline=true}
{"export_id": "exp-001", "title": "Transaction Report", "format": "csv", "status": "completed", "row_count": 1250, "file_size": 45056}
:::
```

Props:
- `export_id` (required): Export identifier used for the download URL.
- `title` (required): Export name displayed in the card header.
- `format` (required): "csv", "json", or "pdf".
- `status` (required): "pending", "generating", "completed", or "failed".
- `row_count` (optional): Number of rows in the export.
- `file_size` (optional): File size in bytes (auto-formatted to KB/MB).
- `error` (optional): Error message when status is "failed".

## image

Displays an image with an optional caption. Clicking opens a lightbox. Use for screenshots, charts, or visual evidence.

```
:::widget{type="image" inline=true}
{"src": "/uploads/screenshot.png", "alt": "Dashboard screenshot", "caption": "Current dashboard view showing KPI metrics."}
:::
```

Props:
- `src` (required): Image URL or path.
- `alt` (optional): Alt text for accessibility.
- `caption` (optional): Caption displayed below the image.

## chart

Interactive Chart.js chart. Supports bar, line, pie, doughnut, radar, and polarArea chart types.

```
:::widget{type="chart" panel=true}
{"chartType": "bar", "title": "Monthly Revenue", "labels": ["Jan", "Feb", "Mar"], "datasets": [{"label": "Revenue", "data": [4200, 5100, 4800]}]}
:::
```

Props:
- `chartType` (optional, default "bar"): Chart type — "bar", "line", "pie", "doughnut", "radar", "polarArea".
- `title` (optional): Heading displayed above the chart.
- `labels` (optional): Array of category labels for the x-axis (or segments for pie/doughnut).
- `datasets` (optional): Array of dataset objects, each with:
  - `label` (required): Dataset legend label.
  - `data` (required): Array of numeric values.
  - `backgroundColor` (optional): Fill color(s). Auto-assigned if omitted.
  - `borderColor` (optional): Border color(s). Auto-assigned if omitted.
  - `borderWidth` (optional): Border width in pixels.
- `options` (optional): Chart.js options object for advanced customization.

## Usage Guidelines

**Inline vs. Panel:**
- Use `inline=true` (default) for small, self-contained information: badges, alerts, short tables, key-value pairs.
- Use `panel=true` for detailed views that benefit from more space: large tables, timelines, charts, diff viewers, data tables with many columns.

**Blocking:**
- Use `blocking=true` only with `confirmation` widgets for high-risk operations.
- Never use blocking for informational widgets.

## Best Practices

- **Prefer text for simple answers.** If the answer is one sentence, do not wrap it in a widget. Use widgets when structured presentation adds genuine value.
- **Do not overuse widgets.** One or two widgets per response is usually sufficient. A wall of widgets is harder to read than prose.
- **Combine related data.** Use one `data-table` instead of multiple `key-value` widgets when showing a collection of similar items.
- **flow-diagram guidance:** Use `flow-diagram` for process flows, entity relationships, and decision trees. For standard flowcharts and sequence diagrams where Mermaid syntax is well-known, prefer `mermaid-diagram`.
- **Match widget to data shape.** Single record = `entity-card`. List of records = `data-table`. Status indicator = `status-badge`. Comparison = `diff-viewer`.
